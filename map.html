<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>AshevilleGreenMap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="../AshevilleGreenMap/css/bootstrap.css" rel="stylesheet">
    <link href="../AshevilleGreenMap/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="SHORTCUT ICON" href="http://ashevillenc.gov/Portals/0/favicon.ico" />
    <link type="text/css" rel="stylesheet" href="../AshevilleGreenMap/css/stylesheet.css"/>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.css" />
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-lightness/jquery-ui.css" /> 
    <link rel="stylesheet" href="../AshevilleGreenMap/js/Leaflet.markercluster-master/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="../AshevilleGreenMap/js/Leaflet.markercluster-master/dist/MarkerCluster.Default.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="../dist/MarkerCluster.Default.ie.css" /><![endif]-->
    <!--<script src="../new/leafletajax/dist/leaflet.ajax.js"></script>-->


    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../TESTSITE/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../AshevilleGreenMap/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../AshevilleGreenMap/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../AshevilleGreenMap/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../AshevilleGreenMap/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../AshevilleGreenMap/ico/favicon.png">
  </head>

  <body>


<!-- NAVBAR
================================================== -->
<div class="navbar-wrapper">
<!-- Wrap the .navbar in .container to center it within the absolutely positioned parent. -->
  <div class="container">
    <div class="container-fluid">
    <div class="navbar navbar-inverse">
      <div class="navbar-inner">
      <!-- Responsive Navbar Part 1: Button for triggering responsive navbar (not covered in tutorial). Include responsive CSS to utilize. -->
        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
            <a class="brand" href="../AshevilleGreenMap/index.html#">AshevilleGreenMap</a>
            <!-- Responsive Navbar Part 2: Place all navbar contents you want collapsed withing .navbar-collapse.collapse. -->
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="pos-button"><div class='btn-group'>
                <button class="btn btn-success" id="Overview" value="0" onclick="bswitch(this.value);">Overview</button>
                <button class="btn btn-success" id="Transportation" value="1" onclick="bswitch(this.value);">Transportation</button>
                <button class="btn btn-success" id="Energy" value="2" onclick="bswitch(this.value);">Energy</button>
                <button class="btn btn-success" value="3">Recycling</button>
                <button class="btn btn-success" value="4">Water</button>
                <button class="btn btn-success" id="Food" value="5" onclick="bswitch(this.value);">Food</button>
              </div></li>
                <!-- Read about Bootstrap dropdowns at http://twitter.github.com/bootstrap/javascript.html#dropdowns -->
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Other Info <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="http://www.ashevillenc.gov/">City of Asheville</a></li>
                    <li><a href="http://opendatacatalog.ashevillenc.gov/">Open Data Asheville</a></li>
                    <li><a href="https://www.facebook.com/pages/Riverside-Cemetery/116156805072088">Join Us on Facebook!</a></li>
                    <li><a href="http://www.flickr.com/photos/66019045@N04/sets/72157630529238250/">Photos on Flickr</a></li>
					          <li><a href="https://github.com/cityofasheville/riversidecemetery.git">Fork us on Github</a></li>
                    <li class="divider"></li>
                    <li class="nav-header">Downloads</li>
                    <li><a href="http://www.ashevillenc.gov/Portals/0/city-documents/parks/parks_docs/riverside/riversidewalkingtour2012[1].pdf">Download Walking Tour PDF</a></li>
                    <li><a href="http://www.ashevillenc.gov/Portals/0/city-documents/parks/parks_docs/riverside/walkingtourmap2012c[1].pdf">Download Walking Map PDF</a></li>
					          <li><a href="../AshevilleGreenMap/img/RiversideFees.pdf">Download Riverside Prices & Fees PDF</a></li>
                  </ul>
                </li>
            </div><!--/.nav-collapse -->
      </div><!-- /.navbar-inner -->
    </div><!-- /.navbar -->
     <div class="row-fluid">
      <div class="span7">   
        <div id="map"></div>
      </div>
      <div class="span5">
        <div id="intro">
          <h1 class="text-success">Welcome to Asheville AshevilleGreenMap!</h1>
          <ul class="unstyled">
            <li>Explore all the <strong class="text-success">Green</strong> infastructure Asheville has to offer.</li>
          </ul> 
          <dl>
            <dt>Transportation</dt>
            <dd>This view provides an in depth look into all the <strong class="text-success">Green</strong> methods to get around town!</dd>
            <dd><button class="btn btn-success" id="Transportation" value="1" onclick="bswitch(this.value);">Transportation</button></dd>
         </dl> 
         <dl>
            <dt>Energy</dt>
            <dd>Checkout what Asheville is using to keep energy <strong class="text-success">Green</strong>!</dd>
            <dd><button class="btn btn-success" id="Energy" value="2" onclick="bswitch(this.value);">Energy</button></dd>
         </dl>  
         <dt>Recycling</dt>
            <dd>Look at how Asheville keeps trash to a minimum keeping our city <strong class="text-success">Green</strong> and beautiful!</dd>
            <dd><button class="btn btn-success" value="3">Recycling</button></dd>
         </dl>  
         <dt>Water</dt>
            <dd>Clean <strong class="text-success">Green</strong> water flows through Asheville!</dd>
            <dd><button class="btn btn-success" value="4">Water</button></dd>
         </dl> 
         <dt>Food</dt>
            <dd>Checkout how Asheville stays <strong class="text-success">Green</strong> with food!</dd>
            <dd><button class="btn btn-success" id="Food" value="5" onclick="bswitch(this.value);">Food</button></dd>
         </dl>           
        </div>
      </div>
    </div>

  </div><!--container fluid-->
  </div> <!-- /.container -->
</div><!-- /.navbar-wrapper -->


<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.js"></script>
<script src="../AshevilleGreenMap/js/Leaflet.markercluster-master/dist/leaflet.markercluster-src.js"></script>
<script src="../AshevilleGreenMap/js/leaflet-hash.js"></script>
<script src="../AshevilleGreenMap/js/azgs-leaflet-master/js/azgs-leaflet/TileLayer.ESRI.js"></script>
<script src="../AshevilleGreenMap/data/parks.js"></script>
<script src="../AshevilleGreenMap/data/PublicEV.geojson"></script>
<script src="../AshevilleGreenMap/data/greenwaydata.js"></script>
<script src="../AshevilleGreenMap/data/sidewalkdata.geojson"></script>
<script src="../AshevilleGreenMap/data/bikedata.js"></script>
<script src="../AshevilleGreenMap/data/bikeRackdata.geojson"></script>
<script src="../AshevilleGreenMap/data/fooddata.geojson"></script>
<script src="../AshevilleGreenMap/js/jquery.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-transition.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-alert.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-modal.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-dropdown.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-scrollspy.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-tab.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-tooltip.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-popover.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-button.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-collapse.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-carousel.js"></script>
<script src="../AshevilleGreenMap/js/bootstrap-typeahead.js"></script>
<script src="../AshevilleGreenMap/js/jquery.dataTables.js"></script>
<script src="../AshevilleGreenMap/js/datatable.bootstrap.js"></script>
<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>	
<script type="text/javascript">
 
//map set up
var map = L.map('map', {
  center: [35.600251, -82.570848],
  zoom: 17.5,
  zoomControl: true 
});

//Adds hash to url          
var hash = new L.Hash(map); 
            
//base map from cloudmade   
var cloudmade = L.tileLayer('http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png', {
	attribution: 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade',
	key: 'BC9A493B41014CAABB98F0471D759707',
  styleId: 22677,
	zIndex: 2
	
}).addTo(map);
		
//point to layer for Geojson layers           
function evPoint (feature, latlng) {
  return L.circleMarker(latlng, {
    fillColor: '#fdaf6b',
    radius: 4,
    color: '#f95897',
    weight: 1,
    fillOpacity: 1
  });
}

function bikeRackpoint (feature, latlng) {
  return L.circleMarker(latlng, {
    fillColor: '#60b9ce',
    radius: 4,
    color: '#ff9f40',
    weight: 1,
    fillOpacity: 1
  });
}

function foodpoint (feature, latlng) {
  return L.circleMarker(latlng, {
    fillColor: '#bf5b30',
    radius: 4,
    color: '#a63100',
    weight: 1,
    fillOpacity: 1
  });
}

//popups for GeoJson layers   
function sidewalkPopUp(feature, layer) {
  layer.bindPopup('<h4>Sidewalk</h4><strong>Segment Type: </strong>' + feature.properties.SEGMENTTYP );
}

function parkPopUp(feature, layer) {
  layer.bindPopup('<h4>Park</h4><strong>Park: </strong>' + feature.properties.parkname + '<br />' + '<strong>Acres: </strong>' + feature.properties.acres);
}

function foodPopUp(feature, layer) {
  layer.bindPopup('<h4>Food</h4><strong>Name: </strong>' + feature.properties.name + '<br />' + '<strong>Address: </strong>' + feature.properties.address + '<br />' + '<strong>Zip Code: </strong>' + feature.properties.zipcode + '<br />' + '<strong>type: </strong>' + feature.properties.type);
}

function evPopUp(feature, layer) {
  layer.bindPopup('<h4>EV Charging Station</h4><strong>Name: </strong>' + feature.properties.Name + '<br />' + '<strong>Description: </strong>' + feature.properties.description);
}

function bikerackPopUp(feature, layer) {
  layer.bindPopup('<h4>Bike Rack</h4><strong># of spaces: </stong>' + feature.properties.BIKE_RACK_ + '<br />' + '<strong>Description: </strong>' + feature.properties.LOCATIONS);
}

function bikeroutePopUp(feature, layer) {
  layer.bindPopup('<h4>Bike Infrastructure</h4><strong>Type: </stong>' + feature.properties.fac_rec + '<br />' + '<strong>Safety: </strong>' + feature.properties.suitability);
}

//Filters for GeoJson Layers
function greenwayFilter(feature, layer){
  if(feature.properties.segmenttype === "GREENWAY"){
    return feature.properties.segmenttype;
  }
}   

function sidewalkFilter(feature, layer){
  if(feature.properties.SEGMENTTYP !== "GREENWAY" && feature.properties.SEGMENTTYP !== "PROPOSED GREENWAY" && feature.properties.SEGMENTTYP !== "PROPOSED 2005 PED PLAN" && feature.properties.SEGMENTTYP !== "NEEDED LINKAGE" ){
    return feature.properties.SEGMENTTYP;
  }
}         

//Styles for Geojson layers
var parkstyle = {
  "color": "#008F3E",
  "weight": 1,
  "opacity": 0.65
  };

var bikestyle = {
  "color": "#ff9400",
  "weight": 3,
  "opacity": 0.65
  };
 
function greenwayStyle(feature) {
  switch (feature.properties.segmenttype) {
    case 'GREENWAY': return {color: "#41db00","weight": 2,"opacity": 0.65};
    case 'PROPOSED GREENWAY': return {color: "#92ed6b","weight": 2,"opacity": 0.65,dashArray: '3'};
    }
}

function sidewalkStyle(feature) {
  switch (feature.properties.SEGMENTTYP) {
    case 'SIDEWALK': return {color: "#6997D3","weight": 2,"opacity": 0.65};
    case 'PARK PATH': return {color: "#92ed6b","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'CROSSWALK': return {color: "#6997D3","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'CONNECTOR CROSSWALK': return {color: "#6997D3","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'FACILITY WALKWAY': return {color: "#5FD2B5","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'PED BRIDGE': return {color: "#6997D3","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'CONNECTOR DRIVEWAY': return {color: "#6997D3","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'CONNECTOR OPEN PARKING': return {color: "#6997D3","weight": 2,"opacity": 0.65,dashArray: '3'};
    case 'CONNECTOR SIDEWALK': return {color: "#6997D3","weight": 2,"opacity": 0.65,dashArray: '3'};
    }
}
      
//GeoJson set Up
var parks = L.geoJson(parks, {style:parkstyle, onEachFeature:parkPopUp});
var EV = L.geoJson(publicEV, {pointToLayer:evPoint, onEachFeature: evPopUp});
var bikes = L.geoJson(bikedata, {style:bikestyle, onEachFeature:bikeroutePopUp});
var greenway = L.geoJson(greenwaydata, {style:greenwayStyle, filter:greenwayFilter});
var sidewalk = L.geoJson(sidewalkdata, {style:sidewalkStyle, filter:sidewalkFilter, onEachFeature: sidewalkPopUp});
var bikeRack = L.geoJson(bikeRackdata, {pointToLayer:bikeRackpoint, onEachFeature:bikerackPopUp});
var food = L.geoJson(fooddata, {pointToLayer:foodpoint, onEachFeature:foodPopUp});

//Layer Groups
//OverviewGroup = L.layerGroup([parks, EV, bikes, greenway, sidewalk, bikeRack, food]);
//TransGroup = L.layerGroup([sidewalk, greenway, bikes, bikeRack, EV]);
//FoodGroup = L.layerGroup([food]);
//EnergyGroup = L.layerGroup([EV]);

//Control Layers
  var baseMaps = {
    "Grey": cloudmade
  };

  var OverviewGroup = {
    "Parks": parks,
    "Electic Vehical": EV,
    "Bikes Routes": bikes,
    "Sidewalks": sidewalk,
    "Greenways": greenway,
    "Bike Racks": bikeRack,
    "Food": food
  };

  var TransGroup = {
    "Sidewalks": sidewalk,
    "Greenways": greenway,
    "Bikes Routes": bikes,
    "Bike Racks": bikeRack,
    "Electic Vehical": EV
  };

  var FoodGroup = {
    "Food": food
  };

  var EnergyGroup = {
    "Electic Vehical": EV
  };

//Temp add layer control
L.control.layers(null, OverviewGroup).addTo(map);

//zoom function for the datatables
function zoomPop(zlayer){
  for(each in zlayer._layers){
     map.fitBounds(zlayer._layers[each].getBounds());
  }
}

//Tables
//Setup Datatables
//Setup Food Table
function ftd(){
var foodTableData = [];
  for(each in food._layers){
    var address = food._layers[each].feature.properties.address;
    var name = food._layers[each].feature.properties.name;
    var notes = food._layers[each].feature.properties.notes;
    var type = food._layers[each].feature.properties.type;
    var zipcode = food._layers[each].feature.properties.zipcode;
    var popUp = food._layers[each]._popup;
    var lat = food._layers[each]._latlng.lat;
    var lng = food._layers[each]._latlng.lng;
    
  
    foodTableData.push([name, type, address, zipcode, '<a href="' + notes + '">notes</a>', '<a href="../AshevilleGreenMap/map.html#18/' + lat + '/' + lng + '">Zoom to Map</a>']);

  }

    $(document).ready(function(){
      $('#datatableFood').dataTable({
        "sPaginationType": "bootstrap",
          "aaData": foodTableData,
          "bProcessing":true,
          "bDeferRender": true,
          "bRetrieve": true,
          "iDisplayLength": 5,
          "aLengthMenu": [5, 10, 15],
          "aoColumns": [
            { "sTitle": "Name"},
            { "sTitle": "Type" },
            { "sTitle": "Address" },
            { "sTitle": "Zip Code", "sClass": "center" },
            { "sTitle": "Notes"},
            { "sTitle": "Zoom"}
          ]
      });
    });
}   

//Setup Energy Table
function etd(){
var EnergyTableData = [];
  for(each in EV._layers){
    var name = EV._layers[each].feature.properties.Name;
    var desc = EV._layers[each].feature.properties.description; 
    var lat = EV._layers[each]._latlng.lat;
    var lng = EV._layers[each]._latlng.lng;
    
    EnergyTableData.push([name,  desc, '<a href="../AshevilleGreenMap/map.html#18/' + lat + '/' + lng + '">Zoom to Map</a>']);
  }
    $(document).ready(function(){
      $('#datatableEnergy').dataTable({
        "sPaginationType": "bootstrap",
          "aaData": EnergyTableData,
          "bProcessing":true,
          "bDeferRender": true,
          "bRetrieve": true,
          "iDisplayLength": 5,
          "aLengthMenu": [5, 10, 15],
          "aoColumns": [
            { "sTitle": "Name"},
            { "sTitle": "Description" },
            { "sTitle": "Zoom"}
          ]
      });
    });
   
}



//Legends
var legendOverview = L.control({position: 'bottomleft'});
  legendOverview.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend');
      div.innerHTML = '<i style="background: #ff9400">    </i>' + '     ' + 'Bike Routes<br /><i style="background: #41db00"></i>' + '     ' + 'Greenways<br /><i style="background: #008F3E "></i>' + '     ' + 'Parks<br /><i style="background: #bf5b30; outline-color: #a63100; border-radius:50px  "></i>' + '     ' + 'Food<br /><i style="background: #60b9ce; outline-color: #ff9f40; border-radius:50px "></i>' + '     ' + 'Bike Racks<br /><i style="background: #fdaf6b; outline-color: #f95897; border-radius:50px  "></i>' + '     ' + 'EV Charging Station<br />';
    return div;
  }

var legendFood = L.control({position: 'bottomleft'});
  legendFood.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend');
      div.innerHTML = '<i style="background: #bf5b30; outline-color: #a63100; border-radius:50px  "></i>' + '     ' + 'Food<br />';
    return div;
  }

//LayerGroup Filter
 function Transportation(){ 
  map.fitBounds(sidewalk.getBounds());
  var control = L.control.layers(null, TransGroup).addTo(map);
   
}

function Energy(){
  map.fitBounds(EV.getBounds());
  var control = L.control.layers(null, EnergyGroup).addTo(map)
  map.addControl(control);
   
}

//Master Control Functoin
//The logic behind adding and removing all elements from the map
//function MS(layer, group, legend){
 function setZoom(layer){
  map.fitBounds(layer.getBounds());
  }

//Method for changing legends
function getLegend(legend){
    //list of all legend names
    var legend_list = [legendOverview, legendFood];
    //Finds the index of the legend
    var lg = legend_list.indexOf(legend);
    //Loop that checks to see which legend to add and which legend to remove
    for(var i = 0; i <= legend_list.length; i++){
      if(i === lg){
        legend_list[i].addTo(map);
      }
      else{
        legend_list[i].removeFrom(map);
      }
    }
  }

//Method to switch Layer control
// function getLayerControl(group){
//     //List of all layer control names
//     var layer_list = [OverviewGroup, TransGroup, EnergyGroup, FoodGroup];
//     //Sets variable of the group index
//     var g = layer_list.indexOf(group);
//     // //Loop that checks to see which layer control to add and which layer control to remove
//     for(var i = 0; i <= layer_list.length; i++){
//       if(i === g){
//         L.control.layers(null, layer_list[i]).addTo(map);
//       }
//       else{
//         L.control.layers(null, layer_list[i]).removeFrom(map);
//       }
//     } 
//   }


//Switch Control 
function bswitch(value){
  switch(value){
    case "0": 
      document.getElementById('intro').innerHTML = '<h1>Welcom to the grand Overview!</h1><br /><p>Hope you enjoy</p>';
      //MS(sidewalk, OverviewGroup, legendOverview);
      setZoom(sidewalk);
      getLegend(legendOverview);
      //getLayerControl(OverviewGroup);
    break;

    case "1":
      Transportation();
          
    break;

    case "2":
      document.getElementById('intro').innerHTML = '<table id="datatableEnergy" class="table table-striped"></table>';
      etd(); 
      //getLayerControl(EnergyGroup);
      
    break;

    case "3":
      Energy();
                     
    break;

    case "4":
      Energy();
                    
    break;

    case "5":
      document.getElementById('intro').innerHTML = '<table id="datatableFood" class="table table-striped"></table>';
      ftd();
      //MS(food, FoodGroup, legendFood);
      setZoom(food);
      getLegend(legendFood);
      //getLayerControl(FoodGroup); 

    break;
               
      default:
        alert("Oops;)");
  }
}




	

   </script>
   <script src="../AshevilleGreenMap/js/holder.js"></script>
  </body>
</html>
